<!doctype html>
<html><head>


</head><body>


    <audio id="sound" src="/fluffy.ogg" controls loop>
      <p>Your browser does not support the audio element.</p>
    </audio>

<hr>


<input type="button" value=" go go go " id="go">

<hr>

<img src="fluffy.gif" style="float:left;height:500px;margin:20px;">
<hr>

<pre id="log"></pre>

<a href="https://github.com/max-weller/fluffy">open source</a>

<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
  var media = $("#sound")[0];
  var socket = io();
  var pingdiff = 0;
  var curver = "";
  socket.on("connect", function() {
        $("#log").append("connected\n");
        var start = +new Date();
        socket.emit("ping", function(time) {
          pingdiff = ((+new Date())-start)/2000;
          $("#log").append("Ping: "+pingdiff+" sek\n");
        });
  });
  socket.on("newuser", function(info) {
        $("#log").append("new user "+info+"\n");
  });
  socket.on("restart", function(ver) {
        if(!curver) { curver = ver; return; } 
        if(ver != curver)
        	location.reload();
  });
  socket.on("volume", function(vol) {
        media.volume = vol;
  });
  socket.on("color", function(color) {
        $("body").css("background", color);
  });
  socket.on("play", function(pos) {
	media.currentTime = pos-pingdiff;
	media.play();
  });
  socket.on("gettime", function(cb) {
	cb(media.currentTime+pingdiff);
  });
  $("#go").click(function() {
    socket.emit("playall", media.currentTime+pingdiff);
  });
</script>
</body></html>
